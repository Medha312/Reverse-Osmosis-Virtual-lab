<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reverse Osmosis Simulator</title>
  <style>
    
  * { box-sizing: border-box; }
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #layout {
        display: grid;
        grid-template-rows: 60px 1fr;
        grid-template-columns: 35% 65%;
        grid-template-areas: "header header" "parameters simulation";
        height: 100vh;
      }
      header {
        grid-area: header;
        background: #005f73;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: bold;
      }
      #instructions {
        background-color: #e6f2ff;
        border: 2px solid #003366;
        padding: 10px 15px;
        margin-bottom: 10px;
        font-weight: bold;
        border-radius: 8px;
        font-size: 16px;
        color: #333333;
      }

      #parameters {
        grid-area: parameters;
        padding: 20px;
        background: linear-gradient(to bottom, #d0f0f7, #ffffff);
        border-right: 2px solid #ccc;
        overflow-y: visible !important;   
      }
      #parameters h2 {
        margin-top: 0;
        font-size: 22px;
        color: #023047;
        text-align: center;
      }
      #parameters h3 {
        margin-top: 30px;
        font-size: 18px;
        color: #005f73;
        margin-bottom: 10px;
        text-align: left;        /* Align text to the left */
        padding-left: 0px;
        text-align: center;
      }
      .slider-box {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
      }
      .slider-subbox {
        width: 48%;
        background: #f0f8ff;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 6px;
        border-radius: 12px; /* increased for more curve */
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        align-items: center; 
      }
      .slider-subbox label {
        display: block;
        margin-bottom: 10px;
      }
      .membrane-images {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        margin-bottom: 10px;
      }
      .membrane {
        flex: 1;
        text-align: center;
        margin: 0 5px;
        cursor: pointer;
      }
      .membrane img {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border: 2px solid #ccc;
        border-radius: 6px;
        transition: border 0.2s, transform 0.2s ease-in-out;
      }

      .membrane img:hover {
        transform: scale(1.1);
        border-color: #0a9396; /* Optional: highlight border color on hover */
        box-shadow: 0 4px 10px rgba(10, 147, 150, 0.4); /* subtle shadow for popping */
        z-index: 10; /* make sure it appears above other elements */
        position: relative;
      }

      .membrane.active img {
        border: 3px solid #0a9396;
      }
      .membrane-label {
        margin-top: 5px;
        font-size: 14px;
        color: #333;
        font-weight: bold;
      }

      .button-section {
        display: flex;
        justify-content: space-around; /* equal spacing */
        align-items: center; /* vertical center alignment */
        margin-top: 30px;
        
      }

      .button-section button {
        background: transparent;
        
        cursor: pointer;
        transition: transform 0.2s ease-in-out;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100px;
        height: 100px;
        background: none;
        border: 2px solid #0a9396;    /* Border similar to your membrane active border color */
        border-radius: 20%; 
      }

      .button-section button:hover {
        transform: scale(1.1);
        border-color: #0077b6;        /* Change border color on hover for effect */
        box-shadow: 0 0 8px rgba(0, 119, 182, 0.6);
      }

      .button-section button img {
        width: 80px;
        height: 80px;
        background: none;
        border: none;
        pointer-events: none;
      }


      #simulation {
        grid-area: simulation;
        display: grid;
        grid-template-rows: 65% 35%;
        height: 100%;
      }
      #beaker-container {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #e6f7ff;
        border-bottom: 2px solid #ccc;
        padding: 10px 20px 20px 20px;
        box-sizing: border-box;
        width: 100%;
        height: 100%; /* or fixed height if needed */
    /* Optional: to control max size */
        max-width: 100%;
        max-height: 100%;

      }
      #graph-container {
        background-color: white;
        
        display: flex;
        justify-content: center;
        align-items: center;
      }
      canvas {
        border: 1px solid #aaa;
        background: white;
      }

  </style>
</head>
<body>
<div id="layout">
    <header>Reverse Osmosis Simulator</header>

    <div id="parameters">
        <h2>Instructions</h2>
        <div id="instructions">Adjust pressure and temperature to start.</div>

        <h2>Parameters</h2>
        <div class="slider-box">
        <div class="slider-subbox">
            <label>Pressure: <span id="pressure-val">0</span> atm</label>
            <input type="range" id="pressure-slider" min="0" max="7" step="0.1" />
        </div>
        <div class="slider-subbox">
            <label>Temperature: <span id="temperature-val">15</span> Â°C</label>
            <input type="range" id="temperature-slider" min="15" max="30" step="1" />
        </div>
        </div>

        <h3>Membranes</h3>
        <div class="membrane-images">
        <div class="membrane" data-membrane="TFC" title="Thin Film Composite Membrane">
            <img src="tfc1.jpeg" alt="TFC">
            <div class="membrane-label">TFC</div>
        </div>
        <div class="membrane" data-membrane="CA" title="Cellulose Acetate Membrane">
            <img src="ca.jpeg" alt="CA">
            <div class="membrane-label">CA</div>
        </div>
        <div class="membrane" data-membrane="PT" title="Polyamide Thin Membrane">
            <img src="pt.jpeg" alt="PT">
            <div class="membrane-label">PT</div>
        </div>
        </div>

        
        <div class="button-section">
            <div style="text-align: center;">
                <button id="start-btn" title="Play">
                <img src="play-circle.jpg" alt="Play" style="vertical-align: middle;"> 
                </button>
                <div style="margin-top: 8px; font-weight: bold;">Play</div>
            </div>
            <div style="text-align: center;">
                <button id="pause-btn" title="Pause">
                <img src="pause-circle.jpg" alt="Pause" style="vertical-align: middle;"> 
                </button>
                <div style="margin-top: 8px; font-weight: bold;">Pause</div>
            </div>
            <div style="text-align: center;">
                <button id="reset-btn" title="Reset">
                <img src="reset-circle.jpg" alt="Reset" style="vertical-align: middle;"> 
                </button>
                <div style="margin-top: 8px; font-weight: bold;">Reset</div>
            </div>
        </div>


    </div>

    <div id="simulation">
        <div id="beaker-container">
        <canvas id="sim-canvas" width="600" height="350"></canvas>
        </div>
        <div id="graph-container">
        <canvas id="fluxChart" width="600" height="200"></canvas>
        </div>
    </div>
    </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const canvas = document.getElementById('sim-canvas');
  const ctx = canvas.getContext('2d');
  const pressureSlider = document.getElementById('pressure-slider');
  const temperatureSlider = document.getElementById('temperature-slider');
  const pressureVal = document.getElementById('pressure-val');
  const temperatureVal = document.getElementById('temperature-val');
  const instructions = document.getElementById('instructions');
  let membraneSelected = false;
  function updateInstructions() {
    const pressureSet = pressure > 0;
    const temperatureSet = temperature > 15; // assuming 15 is default
    const membraneSet = membraneSelected;

    if (!pressureSet || !temperatureSet) {
      instructions.textContent = "Adjust pressure and temperature to start.";
    } else if (!membraneSet) {
      instructions.textContent = "Select membrane.";
    } else {
      instructions.textContent = "Start simulation. Adjust pressure and temperature to see variation.";
    }
  }

  const membranes = {
    TFC: { thickness: 6, color: 'black', gap: 7, allowedSizes: [6] },
    CA: { thickness: 3, color: 'blue', gap: 7, allowedSizes: [6, 8] },
    PT: { thickness: 2, color: 'green', gap: 11, allowedSizes: [6, 8, 10] }
  };

  let selectedMembrane = 'TFC';
  let molecules = [];
  let animationId;
  let running = false;

  function initMolecules() {
    molecules = [];
    const sizes = [6, 8, 10, 12];
    const colors = ['blue', 'red', 'green', 'purple'];
    for (let i = 0; i < 50; i++) {
      const sizeIndex = Math.floor(Math.random() * sizes.length);
      molecules.push({
        x: Math.random() * (canvas.width / 2 - 30),
        y: Math.random() * (canvas.height - sizes[sizeIndex]),
        size: sizes[sizeIndex],
        color: colors[sizeIndex],
        vx: 0,
        vy: 0,
        settled: false
      });
    }
  }

  function drawBeaker() {
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#e0f7fa');
    gradient.addColorStop(1, '#b2ebf2');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = '#0077b6';
    ctx.lineWidth = 3;
    ctx.strokeRect(0, 0, canvas.width, canvas.height);
  }

  function drawMembrane(type) {
    const x = canvas.width / 2;
    ctx.save();
    ctx.translate(x, 0);
    ctx.lineCap = 'round';
    const mem = membranes[type];
    ctx.strokeStyle = mem.color;
    ctx.lineWidth = mem.thickness;

    if (type === 'TFC') {
      ctx.setLineDash([4, 4]);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(0, canvas.height);
      ctx.stroke();
    } else if (type === 'CA') {
      ctx.setLineDash([]);
      let y = 0;
      while (y < canvas.height) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(0, y + 14);
        ctx.stroke();
        y += 20;
      }
    } else if (type === 'PT') {
      ctx.setLineDash([10, 6]);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(0, canvas.height);
      ctx.stroke();
    }

    ctx.restore();
  }

  function updateMolecules(membrane) {
    if (pressure <= 0) return;
    for (let mol of molecules) {
      if (!running) continue;
      let speed = 0.5 + pressure * 0.3 + (temperature - 15) * 0.1;
      if (!mol.settled) {
        mol.vx += 0.05;
        mol.vx = Math.min(mol.vx, speed);
      }
      mol.x += mol.vx;

      if (mol.x >= canvas.width / 2) {
        if (!mol.settled) {
          mol.vy += 0.3 - 0.1 * mol.vy;
          mol.vx -= 0.1 * mol.vx;
          mol.y += mol.vy;

          if (mol.y + mol.size >= canvas.height) {
            mol.y = canvas.height - mol.size;
            mol.vx = mol.vy = 0;
            mol.settled = true;
          }

          if (mol.y < 0) {
            mol.y = 0;
            mol.vy *= -0.6;
          }
        }
      } else {
        mol.y += mol.vy;
        if (mol.y < 0 || mol.y > canvas.height - mol.size) mol.vy *= -1;
      }

      if (
        mol.x + mol.size > canvas.width / 2 &&
        mol.x < canvas.width / 2 + membrane.thickness
      ) {
        if (selectedMembrane === 'CA') {
          const inGap = (mol.y % 20) >= 14;
          if (!membrane.allowedSizes.includes(mol.size) || !inGap) {
            mol.x = canvas.width / 2 - mol.size;
            mol.vx *= -1;
          }
        } else {
          if (!membrane.allowedSizes.includes(mol.size)) {
            mol.x = canvas.width / 2 - mol.size;
            mol.vx *= -1;
          }
        }
      }

      if (mol.x + mol.size > canvas.width) {
        mol.x = canvas.width - mol.size;
        mol.vx *= -1;
      }
      if (mol.x < 0) {
        mol.x = 0;
        mol.vx *= -1;
      }
    }
  }

  function drawMolecules() {
    for (let mol of molecules) {
      ctx.beginPath();
      ctx.fillStyle = mol.color;
      ctx.arc(mol.x, mol.y, mol.size / 2, 0, 2 * Math.PI);
      ctx.fill();
    }
  }

  function animate() {
    const membrane = membranes[selectedMembrane];
    drawBeaker();
    drawMembrane(selectedMembrane);
    updateMolecules(membrane);
    drawMolecules();
    updateGraph(pressure, temperature, membrane);
    animationId = requestAnimationFrame(animate);
  }

  

  const chartCtx = document.getElementById('fluxChart').getContext('2d');
  const chart = new Chart(chartCtx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Water Flux',
        borderColor: 'blue',
        data: [],
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { title: { display: true, text: 'Pressure (atm)' }},
        y: { title: { display: true, text: 'Water Flux (arbitrary units)' }}
      }
    }
  });
  chart.data.labels = ['0'];
  chart.data.datasets[0].data = [0];
  chart.update();
  function updateGraph(pressure, temperature, membrane) {
    if (!running || pressure <= 0) return;
    const flux = pressure * (temperature - 10) * membrane.allowedSizes.length * 0.1;
    chart.data.labels.push(pressure.toFixed(1));
    chart.data.datasets[0].data.push(flux.toFixed(2));
    if (chart.data.labels.length > 50) {
      chart.data.labels.shift();
      chart.data.datasets[0].data.shift();
    }
    chart.update('none');
  }

  pressureSlider.oninput = () => {
    pressure = parseFloat(pressureSlider.value);
    pressureVal.textContent = pressure;
    updateInstructions();
  };

  temperatureSlider.oninput = () => {
    temperature = parseFloat(temperatureSlider.value);
    temperatureVal.textContent = temperature;
    updateInstructions();
  };

  document.getElementById('start-btn').onclick = () => {
    if (!running && pressure > 0) {
      running = true;
      animate();
    }
  };

  document.getElementById('pause-btn').onclick = () => {
    running = false;
    cancelAnimationFrame(animationId);
  };

  document.getElementById('reset-btn').onclick = () => {
    running = false;
    cancelAnimationFrame(animationId);
    initMolecules();
    chart.data.labels = ['0'];
    chart.data.datasets[0].data = [0];
    chart.update();

    pressureSlider.value = 0;
    temperatureSlider.value = 15;
    pressureVal.textContent = '0';
    temperatureVal.textContent = '15';
    pressure = 0;
    temperature = 15;

    drawBeaker();
    drawMembrane(selectedMembrane);
    drawMolecules();
    instructions.textContent = "Adjust pressure and temperature to start.";
  };

  document.querySelectorAll('.membrane').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.membrane').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedMembrane = btn.getAttribute('data-membrane');
      membraneSelected = true;
      drawBeaker();
      drawMembrane(selectedMembrane);
      drawMolecules();
      updateInstructions();
    };
  });

  let pressure = 0, temperature = 15;
  pressureSlider.value = 0;
  temperatureSlider.value = 15;
  pressureVal.textContent = '0';
  temperatureVal.textContent = '15';

  initMolecules();
  drawBeaker();
  drawMembrane(selectedMembrane);
  drawMolecules();
</script>
</body>
</html>
